# Handoff Document
Generated: 2026-01-15 22:39:58

## Summary

Formalized specialized agent definitions for the `parallel_claudes` plugin. Created 5 dedicated agent files (security, performance, edge_cases, maintainability, testing) that can be loaded by commands instead of using inline prompts. Then fixed issues identified in a Codex code review.

## Current Status

### Completed
- Created `agents/` directory with 6 files:
  - `README.md` - Documents the agent system
  - `security_agent.md` - Security specialist (OWASP, injection, auth)
  - `performance_agent.md` - Performance specialist (Big O, memory, caching)
  - `edge_cases_agent.md` - Edge cases specialist (null handling, boundaries)
  - `maintainability_agent.md` - Maintainability specialist (SOLID, coupling)
  - `testing_agent.md` - Testing specialist (coverage, testability)

- Updated all 4 commands to use agent system:
  - `role_based_review.md` - Removed ~170 lines of inline prompts, now loads from agent files
  - `parallel_generation.md` - Added `--roles` flag for specialized generation
  - `generation_and_review.md` - Added `--reviewer-roles` flag for specialized review
  - `swarm.md` - Updated to support local agent files

- Fixed issues from Codex review:
  - Added `MODE: GENERATION` override when agents used for generation (not review)
  - Added fallback logic when `--roles` is empty or all invalid
  - Fixed error messages showing wrong default (full → compressed)
  - Updated README to mention all 5 perspectives (was 3)
  - Fixed agents/README.md format claim

### In Progress
- Nothing currently in progress

### Pending
- Commit the changes
- Test the new agent system in real usage

## Recent Changes

### New Files (Untracked)
```
plugins/parallel_claudes/agents/
├── README.md              (3.7 KB)
├── security_agent.md      (6.1 KB)
├── performance_agent.md   (6.4 KB)
├── edge_cases_agent.md    (6.5 KB)
├── maintainability_agent.md (7.1 KB)
└── testing_agent.md       (6.8 KB)
```

### Modified Files
- `plugins/parallel_claudes/README.md` - Added "Specialized Agents" section, new flags
- `plugins/parallel_claudes/commands/role_based_review.md` - Removed inline prompts, added agent loading
- `plugins/parallel_claudes/commands/parallel_generation.md` - Added `--roles` flag with mode adaptation
- `plugins/parallel_claudes/commands/generation_and_review.md` - Added `--reviewer-roles` flag
- `plugins/parallel_claudes/commands/swarm.md` - Updated agent table, added mode adaptation

### Key Code Changes

1. **Agent File Structure** (YAML frontmatter + markdown):
   ```yaml
   ---
   name: Security Specialist
   slug: security
   category: reviewer
   verdicts: [SECURE, NEEDS ATTENTION, VULNERABLE]
   ---
   # Identity, Responsibilities, Focus Areas, What to Ignore, Output Format, Verdict Criteria
   ```

2. **Mode Adaptation** - When using review agents for generation:
   ```
   **MODE: GENERATION (not review)**
   Output a complete code solution, not review findings.
   Do NOT output CRITICAL/WARNING/SUGGESTION sections.
   ```

3. **Fallback Logic** - When `--roles` is empty or all invalid:
   ```
   Warn and fall back to --count generic agents
   Message: "No valid roles specified. Falling back to [N] generic agents."
   ```

## Next Steps

1. **Commit the changes**:
   ```bash
   git add plugins/parallel_claudes/
   git commit -m "Add formalized agent definitions with mode adaptation"
   ```

2. **Test the agent system**:
   - `/parallel_claudes:role_based_review` - Should load agents from files
   - `/parallel_claudes:parallel_generation --roles security,performance` - Should produce code, not review
   - Test fallback with invalid roles

3. **Consider adding more agents** (optional):
   - API design specialist
   - Database/query specialist
   - Accessibility specialist

## Context & Notes

### Important Context
- Agents are defined as `category: reviewer` but are now also used for generation via mode adaptation
- The `--roles` flag in `parallel_generation` overrides `--count` (one agent per role)
- The `--reviewer-roles` flag in `generation_and_review` similarly overrides `--count`
- `role_based_review` defaults to all 5 agents; other commands default to generic agents

### Gotchas
- When using specialized agents for generation, the MODE override is critical - without it, agents will output review findings instead of code
- Error messages must match actual defaults (most commands use `compressed`, only `role_based_review` uses `full`)
- The `category` field in agent YAML is currently just for organization/future use

### File Paths
- Agents directory: `plugins/parallel_claudes/agents/`
- Agent loading uses: `${CLAUDE_PLUGIN_ROOT}/agents/{slug}_agent.md`
- Slugs must match filenames (e.g., `security` → `security_agent.md`)
